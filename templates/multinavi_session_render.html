$def with( global_info)

<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>multinavi session 统计</title>
    
    <script src="/static/js/jquery.min.js"></script>    
    <script src="/static/js/highstock.js"></script>
    <script src="/static/js/exporting.js"></script> 
    <script src="/static/js/jquery.min.map"></script>   
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.core.js"></script>
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.widget.js"></script>
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.datepicker.js"></script>
    <link rel="stylesheet" href="/static/jquery-ui-1.10.3/themes/base/jquery.ui.all.css">
    <link rel="stylesheet" href="/static/jquery-ui-1.10.3/demos/demos.css">
    <style type="text/css">
        html,body
        {
            height: 100%;
            margin: 0;
            
        }
        .left
        {
            float: left;
            height: 6000px;
            width: 200px;
            background:#88ee88;
            border: 5px solid #88ee88 ;
        }
        .right
        {
            margin-left:210px; 
            height: 6000px;
            width: 1100px;
            background:#eeffee;
            border: 3px solid #80e080 ;
        }  
        .divtool
        {
            width: 100%;
            height: 100px;
            box-shadow: 0 0 1px #0f0f0f;
        }
        .divcomment
        {
            width: 100%;
            height: 5900px ;
            background:#ffffee ;
        }
        .divtoolname
        {
            width: 100%;
            height: 35%;
            text-align:center;
            background:#ccffdd;
            box-shadow: 0 0 3px #0f0f0f;
        }
        .divtooltools
        {
            width: 100%;
            height: 63%;
            box-shadow: 0 0 3px #0f0f0f;
        }
        .buttonLeft
        {
            width:80%;
            height:30px;
            box-shadow: 0 0 1px #0f0f0f;
        }
    </style>
</head>
<body>
    <form id="log_form" method="POST">
        <div class="left" id="div_left">
            <div style="width:100%;height:130px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >概览信息</a>
                    </div>
                    <p><input type="button" value="导航统计概览" class="buttonLeft" onclick="button_jump_click('top_all')"></p>
                    <p><input type="button" value="导航关键统计报表" class="buttonLeft" onclick="button_jump_click('kes_stat')"></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:150px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >日志信息查询</a>
                    </div>
                    <p><input type="button" value="错误日志查询" class="buttonLeft" onclick="button_jump_click('error_log')"></p>
                    <p><input type="button" value="cuid查询" class="buttonLeft" onclick="button_jump_click('cuid_log')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >端信息查询</a>
                    </div>
                    <p><input type="button" value="端pv统计"  class="buttonLeft"  onclick="button_jump_click('port_pv')" ></p>
                    <p><input type="button" value="端错误率统计"  class="buttonLeft"  onclick="button_jump_click('port_error')" ></p>
                    <p><input type="button" value="端非法率统计"  class="buttonLeft"  onclick="button_jump_click('port_illegal')" ></p>
                    <p><input type="button" value="端数据量统计"  class="buttonLeft"  onclick="button_jump_click('port_data')" ></p>
                    <p><input type="button" value="端性能统计"  class="buttonLeft"  onclick="button_jump_click('port_performance')" ></p>
                    <p><input type="button" value="偏航统计" class="buttonLeft" onclick="button_jump_click('yawpos_summary')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >version信息查询</a>
                    </div>
                    <p><input type="button" value="version-pv统计"  class="buttonLeft" onclick="button_jump_click('version_pv')" ></p>
                    <p><input type="button" value="version错误率统计"  class="buttonLeft" onclick="button_jump_click('version_error')" ></p>
                    <p><input type="button" value="version非法率统计"  class="buttonLeft" onclick="button_jump_click('version_illegal')" ></p>
                    <p><input type="button" value="version数据量统计" class="buttonLeft"  onclick="button_jump_click('version_data')" ></p>
                    <p><input type="button" value="version性能统计" class="buttonLeft" onclick="button_jump_click('version_performance')" ></p>
                    <p><input type="button" value="模块性能统计" class="buttonLeft" onclick="button_jump_click('module_performance')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:120px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >用户反馈信息查询</a>
                    </div>
                    <p><input type="button" value="用户吐槽类型统计"  class="buttonLeft" onclick="button_jump_click('naviure_type_flag')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >其他信息查询</a>
                    </div>
                    <p><input type="button" value="multinavi session 统计" class="buttonLeft" onclick="button_jump_click('multinavi_session_query')" ></p>
                    <p><input type="button" value="特殊路线pv统计" class="buttonLeft" onclick="button_jump_click('special_route_type_pv')" ></p>
                    <p><input type="button" value="城市query统计" class="buttonLeft" onclick="button_jump_click('city_query')" ></p>
                    <p><input type="button" value="多路线召回信息统计" class="buttonLeft" onclick="button_jump_click('multi_route_recall')" ></p>
                    <p><input type="button" value="导航偏好信息统计" class="buttonLeft" onclick="button_jump_click('navigation_preference')" ></p>
                    <p><input type="button" value="时间评估统计" class="buttonLeft" onclick="button_jump_click('route_time_ratio')" ></p>
                </center>
            </div>
        </div>
        <div class="right" id="div_right">
            <div class="divtool">
                <div class="divtoolname">
                    <a style="font-size:20px">multinavi session 统计</a>
                    
                </div>
                <div class="divtooltools">
                    <div style="margin-left:2px;float:left;width:250px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >时间选择 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            From: <input type="text" id="datepicker_from" name="datepicker_from" style="width:80px">
                            To: <input type="text" id="datepicker_to" name="datepicker_to" style="width:80px">
                        </center>
                    </div>
                    <div style="margin-left:3px;float:left;width:300px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >端及version选择 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            端：<select name="select_port_name" id="select_port_name"></select>
                            Version：<select name="select_version" id="select_version"></select>
                        </center>
                    </div>
                    <div style="margin-left:3px;float:left;width:120px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >查询操作 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            <input type="button" value="查询"  name="Button_Search" id="Button_Search" onclick="search_button_on_click()" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;">
                        </center>
                    </div>
                    <div style="margin-left:3px;float:left;width:360px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >展示选项 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            <input type="button" id="button_hour" name="button_hour" value="按小时展示" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="button_hour_click()" >
                            <input type="button" id="button_day" name="button_day" value="按天数展示" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="button_day_click()" >
                            <input type="button" id="button_week" name="button_week" value="按周展示" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="button_week_click()" >
                        </center>
                    </div>
                </div>
            </div>
            <div class="divcomment">
                <center>
                    <div style="width:100%;height:400px">
                        <div id="uv_num_stock" style="float:left;height:100%;width:65%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                        <div id="uv_num_pie" style="float:right;height:100%;width:35%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                    </div>
                    <div style="height:5px;width:100%"></div>
                    <div style="width:100%;height:400px">
                        <div id="state_pv_stock" style="float:left;height:100%;width:65%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                        <div id="state_pv_pie" style="float:right;height:100%;width:35%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                    </div>
                    <div style="height:5px;width:100%"></div>
                    <div style="width:100%;height:45px;background:#0ff;box-shadow: 0 0 1px #0f0f0f;">
                        <div style="float:left;height:100%;width:60%;background:#0ee">
                            </br>
                            <a style="font-size:16px;" >状态组合选择（例如选择最后一位状态为3，则查询内容包括1,3 以及 1,2,3 ， 0则查询全部）</a>
                        </div>
                        <div style="float:right;height:100%;width:40%;background:#0ee">
                            </br>
                            <a style="font-size:18px;" >最后一位状态为：</a>
                            <select name="select_last_state" id="select_last_state"></select>
                            <input type="button" value="查询" id="state_combination_search_button" onclick="state_combination_search_button_on_click()" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;">
                        </div>
                    </div>
                    <div style="width:100%;height:400px">
                        <div id="state_combination_stock" style="float:left;height:100%;width:65%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                        <div id="state_combination_pie" style="float:right;height:100%;width:35%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                    </div>
                    <div style="height:5px;width:100%"></div>
                    <div style="height:5px;width:100%"></div>
                    <div style="width:100%;height:400px">
                        <div id="session_time_txt" style="float:left;height:100%;width:23%;background:#fff;box-shadow: 0 0 1px #0f0f0f;"></div>
                        <div id="session_time_stock" style="float:right;height:100%;width:77%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                    </div>
                    <div style="width:100%;height:1600px">
                        <div id="session_time_distribution_div" style="height:100%;width:100%;background:#0ff;box-shadow: 0 0 1px #0f0f0f;"></div>
                    </div>
                </center>
            </div>
        </div>
    </form>
</body>


<script type="text/javascript">
    JQ = jQuery.noConflict();
    
    var host_port    = $:global_info ;
    var host        = "http://" + host_port[0] ;
    var port_num    = host_port[1] ;
    function button_jump_click( target_page ){
        var url = host + ":" + port_num + "/" + target_page;
        window.open( url , "_self");
    }
    
    
    
    JQ(function() {
        JQ( "#datepicker_from" ).datepicker();
    });
    
    JQ(function() {
        JQ( "#datepicker_to" ).datepicker();
    });
    
    var uv_data_dict = {};
    var state_pv_data_dict = {};
    var state_combination_data_dict = {};
    var session_time_data_dict   = {};
    
    var session_time_divide = ["0s",
                                "1s","10m","20m","30m","40m","50m",
                                "1h","1h10m","1h20m","1h30m","1h40m","1h50m",
                                "2h","2h10m","2h20m","2h30m","2h40m","2h50m",
                                "3h","3h10m","3h20m","3h30m","3h40m","3h50m",
                                "4h","4h10m","4h20m","4h30m","4h40m","4h50m",
                                "5h","6h","7h","8h","9h","10h",
                                "11h","12h","13h","14h","15h","16h",
                                "17h","18h","19h","20h","21h","22h",
                                "23h","24h"
                                ];
    var show_session_time_divide_vec = [];
    for( var i = 0 ; i < session_time_divide.length - 1 ; i++ ){
        show_session_time_divide_vec.push( "["+session_time_divide[i] + "," + session_time_divide[i+1] + ")" );
    }
    var show_model      = "DAY";
    
    var port_name_2_port_name_show = {}
    port_name_2_port_name_show[ "all" ]    = "全部";
    port_name_2_port_name_show[ "0" ]   = "来源未知";
    port_name_2_port_name_show[ "1" ]   = "百度地图";
    port_name_2_port_name_show[ "51" ]  = "百度导航";
    //port_name_2_port_name_show[ "-10" ] = "resid不存在";
    
    
    var version_2_name = {}
    version_2_name[ "all" ]    = "全部";
    version_2_name[ "1" ]   = "1";
    
    var select_port_name_innerHTML = "";
    var select_version_innerHTML = "";
    for( var i in port_name_2_port_name_show ){
        if( i!="all" ){
            select_port_name_innerHTML += "<option value=" + i + ">" + port_name_2_port_name_show[i] + "</option>" ;
        }else{
            select_port_name_innerHTML += "<option value=" + i + "  selected='selected' >" + port_name_2_port_name_show[i] + "</option>" ;
        }
    }
    for( var i in version_2_name ){
        if( i!="all" ){
            select_version_innerHTML += "<option value=" + i + ">" + version_2_name[i] + "</option>" ;
        }else{
            select_version_innerHTML += "<option value=" + i + "  selected='selected' >" + version_2_name[i] + "</option>" ;
        }
    }
    document.getElementById("select_port_name").innerHTML = select_port_name_innerHTML;
    document.getElementById("select_version").innerHTML = select_version_innerHTML;
    
    
    var select_last_state_innerHTML = "";
    for( var i = 0 ; i <=6 ; i++ ){
        select_last_state_innerHTML += "<option value=" + i + ">" + i + "</option>"
    }
    document.getElementById("select_last_state").innerHTML = select_last_state_innerHTML;
    
    
    
    function resid_version_to_name( resid_version ){
        var resid = resid_version.split('|')[0];
        var version = resid_version.split('|')[1];
        if( resid in port_name_2_port_name_show ){
            return port_name_2_port_name_show[resid] + "_" + version;
        }
        return "其他_" + version;
    }
    
    
    function createStockChart( div_id , title , ytitle , decimals , suffix , ysuffix , mydata , need_point ){
        JQ('#' + div_id ).highcharts
        (
            {
                chart: {
                    type: 'spline'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: title
                },
                xAxis: {
                    type: 'datetime'
                },
                yAxis: {
                    title: {
                        text: ytitle
                    },
                    labels: {
                        formatter: function() {
                            return this.value + ysuffix;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true,
                    useHTML : true,
                    headerFormat : '<small>{point.key}</small><table>',
                    pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + '<td style="text-align:right"><b>{point.y}</b></td></tr>',
                    footerFormat: '</table>',
                    valueDecimals : decimals,
                    valueSuffix: suffix
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: need_point
                        }
                    }
                },
                navigator: {
                    margin: 2,
                    height: 20
                },
                rangeSelector: {
                    enabled: false
                },
                series: mydata
            }
        );
    }
    
    
    function createStockChartExtraPV( div_id , title , ytitle , mydata , need_point ){
		JQ('#' + div_id ).highcharts
		(
			'StockChart',
			{
				chart: {
					type: 'spline'
				},
				credits: {
					enabled: false
				},
				title: {
					text: title
				},
				xAxis: {
					type: 'datetime'
				},
				yAxis: {
					title: {
						text: ytitle
					},
					labels: {
						formatter: function() {
							return this.value;
						}
					}
                },
				legend: { 
					enabled: true 
				},
				tooltip:{
                    crosshairs: true,
					shared: true,
					useHTML : true,
					headerFormat : '<small>{point.key}</small></br>名称：数目（比例）<table>',
					pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + 
                                    '<td style="text-align:right"><b>{point.y}</b></td>' + 
                                    '<td style="text-align:right"><b>({point.extra:.2f}%)</b></td></tr>',
					footerFormat: '</table>'
                },
				plotOptions: {
					series: {
						marker: {
							enabled: need_point
						}
					}
				},
				navigator: {
					margin: 2,
					height: 20
				},
				rangeSelector: {
					enabled: false
				},
				series: mydata
			}
		);
	}
    
    function createPieWithPercent( div_id , title , mydata , total_num ){
        JQ('#' + div_id ).highcharts(
            {
                title: { 
                    text: title 
                },
                tooltip: {
                    formatter: function() {
                        return '<b>数目&比例</b><br>' +
                            '数目:  ' + Highcharts.numberFormat(this.y, 0) + '<br>' +
                            '比例:  ' + Highcharts.numberFormat(this.y * 100.0 / total_num , 2 ) + '%';
                    }    
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer'
                    }
                },
                series: mydata
            }
        );
    }
    
    

    function draw_uv_tables(){
        if( show_model == "HOUR" ){
            return;
        }
        var tmp_name_list   = uv_data_dict["name_list"];
        var name_list = [];
        for( var i = 0 ; i < tmp_name_list.length ; i++ ){
            name_list.push( resid_version_to_name( tmp_name_list[i] ) );
        }
        var show_total_uv_list = uv_data_dict["total_uv_list"];
        var show_total_uv_percent = uv_data_dict["total_uv_percent"];
        var start_time  = uv_data_dict["week_range"][0] * 3600 * 1000;
        var point_interval = 7 * 24 * 3600 * 1000;
        var show_uv_list = uv_data_dict["week_uv_list"];
        var show_uv_percent = uv_data_dict["week_uv_percent"];
        if( show_model == "DAY" ){
            start_time  = uv_data_dict["day_range"][0] * 3600 * 1000;
            point_interval = 24 * 3600 * 1000;
            show_uv_list = uv_data_dict["day_uv_list"];
            show_uv_percent = uv_data_dict["day_uv_percent"];
        }
        var mydata = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            var tmp_data = [];
            for( var j = 0 ; j < show_uv_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:show_uv_list[i][j],
                        extra:show_uv_percent[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name:name_list[i],
                    pointInterval: point_interval,
                    pointStart: start_time ,
                    data: tmp_data
                }
            );
        }
        createStockChartExtraPV( "uv_num_stock" , "multinavi uv 统计" , "uv 数目" , mydata , true );
        
        
        var tmp_data = [];
        var total_num = 0;
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data.push(
                {
                    name:name_list[i],
                    y:show_total_uv_list[i]
                }
            );
            total_num += parseInt( show_total_uv_list[i] );
        }
        mydata=[
            {
                type: 'pie',
                name: 'uv次数&比例',
                data: tmp_data
            }
        ];
        createPieWithPercent( "uv_num_pie" , "uv次数&比例" , mydata , total_num );
        
    }

    function draw_state_pv_tables(){
        var name_list   = state_pv_data_dict["name_list"];
        var show_total_pv_list = state_pv_data_dict["total_pv_list"];
        var show_total_pv_percent = state_pv_data_dict["total_pv_percent"];
        var start_time  = state_pv_data_dict["week_range"][0] * 3600 * 1000;
        var point_interval = 7 * 24 * 3600 * 1000;
        var show_pv_list = state_pv_data_dict["week_pv_list"];
        var show_pv_percent = state_pv_data_dict["week_pv_percent"];
        if( show_model == "DAY" ){
            start_time  = state_pv_data_dict["day_range"][0] * 3600 * 1000;
            point_interval = 24 * 3600 * 1000;
            show_pv_list = state_pv_data_dict["day_pv_list"];
            show_pv_percent = state_pv_data_dict["day_pv_percent"];
        }else if( show_model == "HOUR" ){
            start_time  = state_pv_data_dict["hour_range"][0] * 3600 * 1000;
            point_interval = 3600 * 1000;
            show_pv_list = state_pv_data_dict["hour_pv_list"];
            show_pv_percent = state_pv_data_dict["hour_pv_percent"];
        }
        var mydata = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            var tmp_data = [];
            for( var j = 0 ; j < show_pv_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:show_pv_list[i][j],
                        extra:show_pv_percent[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name:name_list[i],
                    pointInterval: point_interval,
                    pointStart: start_time ,
                    data: tmp_data
                }
            );
        }
        createStockChartExtraPV( "state_pv_stock" , "state pv 统计" , "pv 数目" , mydata , true );
        
        
        var tmp_data = [];
        var total_num = 0;
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data.push(
                {
                    name:name_list[i],
                    y:show_total_pv_list[i]
                }
            );
            total_num += parseInt( show_total_pv_list[i] );
        }
        mydata=[
            {
                type: 'pie',
                name: 'uv次数&比例',
                data: tmp_data
            }
        ];
        createPieWithPercent( "state_pv_pie" , "state pv次数&比例" , mydata , total_num );
        
    }

    function draw_state_combination_tables(){
        if( show_model == "HOUR" ){
            return;
        }
        var name_list   = state_combination_data_dict["name_list"];
        var show_total_pv_list = state_combination_data_dict["total_pv_list"];
        var show_total_pv_percent = state_combination_data_dict["total_pv_percent"];
        var last_state = document.getElementById("select_last_state").value;
        var visibility_list = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            states = name_list[i].split(',');
            if( last_state == "0" ){
                visibility_list.push(true);
            }else if( last_state == states[states.length - 1] ){
                visibility_list.push(true);
            }else{
                visibility_list.push(false);
            }
        }
        
        
        var start_time  = state_combination_data_dict["week_range"][0] * 3600 * 1000;
        var point_interval = 7 * 24 * 3600 * 1000;
        var show_pv_list = state_combination_data_dict["week_pv_list"];
        var show_pv_percent = state_combination_data_dict["week_pv_percent"];
        if( show_model == "DAY" ){
            start_time  = state_combination_data_dict["day_range"][0] * 3600 * 1000;
            point_interval = 24 * 3600 * 1000;
            show_pv_list = state_combination_data_dict["day_pv_list"];
            show_pv_percent = state_combination_data_dict["day_pv_percent"];
        }
        var mydata = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            if(!visibility_list[i]){
                continue;
            }
            var tmp_data = [];
            for( var j = 0 ; j < show_pv_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:show_pv_list[i][j],
                        extra:show_pv_percent[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name:name_list[i],
                    pointInterval: point_interval,
                    pointStart: start_time ,
                    data: tmp_data
                }
            );
        }
        createStockChartExtraPV( "state_combination_stock" , "状态组合统计" , "pv数目" , mydata , true );
        
        var tmp_data = [];
        var total_num = 0;
        for( var i = 0 ; i < name_list.length ; i++ ){
            if(!visibility_list[i]){
                continue;
            }
            tmp_data.push(
                {
                    name:name_list[i],
                    y:show_total_pv_list[i]
                }
            );
            total_num += parseInt( show_total_pv_list[i] );
        }
        mydata=[
            {
                type: 'pie',
                name: 'pv次数&比例',
                data: tmp_data
            }
        ];
        createPieWithPercent( "state_combination_pie" , "pv次数&比例" , mydata , total_num );
    }
    
    function draw_session_time_tables(){
        if( show_model == "HOUR" ){
            return;
        }
        var name_list   = session_time_data_dict["name_list"];
        var session_time_distribution_num = session_time_data_dict["session_time_distribution_num"];
        var session_time_distribution_percent = session_time_data_dict["session_time_distribution_percent"];
        var show_total_time_list = session_time_data_dict["total_time_list"];
        var start_time  = session_time_data_dict["week_range"][0] * 3600 * 1000;
        var point_interval = 7 * 24 * 3600 * 1000;
        var show_time_list = session_time_data_dict["week_time_list"];
        if( show_model == "DAY" ){
            start_time  = session_time_data_dict["day_range"][0] * 3600 * 1000;
            point_interval = 24 * 3600 * 1000;
            show_time_list = session_time_data_dict["day_time_list"];
        }
        var mydata = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name:name_list[i],
                    pointInterval: point_interval,
                    pointStart: start_time ,
                    data: show_time_list[i]
                }
            );
        }
        createStockChart( "session_time_stock" , "session用时统计" , "时间/秒" , 0 , 's' , 's' , mydata , true );
        var total_time_inner_html = "</br></br><a style='font-size:24px;' >用时统计</a></br></br>";
        for( var i = 0 ; i < name_list.length ; i++ ){
            total_time_inner_html = total_time_inner_html + 
                "<a style='font-size:20px;' > " + name_list[i] + ":" + show_total_time_list[i] + "秒</a></br>";
        }
        document.getElementById('session_time_txt').innerHTML = total_time_inner_html;
        
        
        var tmp_data = [];
        for( var i = 0 ; i < session_time_distribution_num.length ; i++ ){
            tmp_data.push(
                {
                    y:session_time_distribution_num[i],
                    extra:session_time_distribution_percent[i]
                }
            );
        }
        mydata = [];
        mydata.push(
            {
                name : "session用时分布",
                data : tmp_data
            }
        );        
        JQ('#session_time_distribution_div').highcharts({                                           
            chart: {                                                           
                type: 'bar'                                                    
            },                                                                 
            title: {                                                           
                text: 'session用时分布'                    
            },                                                                
            xAxis: {    
				categories: show_session_time_divide_vec                                                    
            },                                                                 
            yAxis: {
				min: 0,
				title: {
					text: '分布数目'
				},
				labels: {
					formatter: function() {
						return this.value;
					}
				}
			},  
            legend: { 
                enabled: false 
            },
            credits: { 
				enabled: false 
			},                                                        
            tooltip:{
                crosshairs: true,
                shared:true,
                useHTML : true,
                formatter : function(){
                    res = '<small>' + this.x + '</small>'
                    res = res + '<table>';
                    for( var i = 0 ; i < this.points.length ; i++ ){
                        res = res + 
                            '<tr>' + 
                                '<td>' +  Highcharts.numberFormat( this.points[i].point.y , 0 ) + '次' + 
                                '(' + Highcharts.numberFormat( this.points[i].point.extra , 2 )  + '%)</td>' + 
                            '</tr>';
                    }
                    res = res + '</table>';
                    return res;
                }
            },
			series: mydata                                                                
        });                                                                                                                                         				
    }
    
    
    function draw_tables(){
        draw_uv_tables();
        draw_state_pv_tables();
        draw_state_combination_tables();
        draw_session_time_tables();
    }
    
    function button_hour_click(){
        show_model = "HOUR";
        draw_tables();
    }
    
    function button_day_click(){
        show_model = "DAY";
        draw_tables();
    }
    
    function button_week_click(){
        show_model = "WEEK";
        draw_tables();
    }
    
    function state_combination_search_button_on_click(){
        button_day_click();
    }
    
    
    var xmlHTTP = new XMLHttpRequest();
    function query_info_done(){
        if( xmlHTTP.readyState == 4 && xmlHTTP.status == 200){
            json_obj = eval('(' + xmlHTTP.responseText + ')');
            document.getElementById("datepicker_from").value = json_obj['date_from'];
            document.getElementById("datepicker_to").value   = json_obj['date_to'];
            var data_dict = json_obj;
            data_len  = data_dict['data_len'];
            if( data_len <= 0 ){
                alert( "该查询日期内无数据");
                exit(0) ;
            }
            show_model = "DAY";
            uv_data_dict = data_dict["uv_dict"];
            state_pv_data_dict = data_dict["state_pv_dict"];
            session_time_data_dict = data_dict["session_time_dict"];
            state_combination_data_dict = data_dict["state_combination_dict"];
            draw_tables();
        }
    }
    
    function search_button_on_click(  ){
        var url = host + ":" + port_num + "/multinavi_session_query_get_data";
        var info = "";
        info = info + "date_from=" + document.getElementById("datepicker_from").value ;
        info = info + "&date_to=" + document.getElementById("datepicker_to").value ;
        info = info + "&resid=" + document.getElementById("select_port_name").value ;
        info = info + "&version=" + document.getElementById("select_version").value ;
        xmlHTTP.open("POST", url, true);
        xmlHTTP.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xmlHTTP.onreadystatechange = query_info_done;
        xmlHTTP.send( info );
    }
    
    search_button_on_click();
    
</script>
















</html>
