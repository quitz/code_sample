$def with( global_info)

<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>导航统计概览</title>
    
    <script src="/static/js/jquery.min.js"></script>    
    <script src="/static/js/highstock.js"></script>
    <script src="/static/js/exporting.js"></script> 
    <script src="/static/js/jquery.min.map"></script>   
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.core.js"></script>
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.widget.js"></script>
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.datepicker.js"></script>
    <link rel="stylesheet" href="/static/jquery-ui-1.10.3/themes/base/jquery.ui.all.css">
    <link rel="stylesheet" href="/static/jquery-ui-1.10.3/demos/demos.css">
    <style type="text/css">
        html,body
        {
            height: 100%;
            margin: 0;
            
        }
        .left
        {
            float: left;
            height: 6000px;
            width: 200px;
            background:#88ee88;
            border: 5px solid #88ee88 ;
        }
        .right
        {
            margin-left:210px; 
            height: 6000px;
            width: 1100px;
            background:#eeffee;
            border: 3px solid #80e080 ;
        }  
        .divtool
        {
            width: 100%;
            height: 100px;
            box-shadow: 0 0 1px #0f0f0f;
        }
        .divcomment
        {
            width: 100%;
            height: 5900px ;
            background:#ffffee ;
        }
        .divtoolname
        {
            width: 100%;
            height: 35%;
            text-align:center;
            background:#ccffdd;
            box-shadow: 0 0 3px #0f0f0f;
        }
        .divtooltools
        {
            width: 100%;
            height: 63%;
            box-shadow: 0 0 3px #0f0f0f;
        }
        .buttonLeft
        {
            width:80%;
            height:30px;
            box-shadow: 0 0 1px #0f0f0f;
        }
    </style>
</head>
<body>
    <form id="log_form" method="POST">
        <div class="left" id="div_left">
            <div style="width:100%;height:130px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >概览信息</a>
                    </div>
                    <p><input type="button" value="导航统计概览" class="buttonLeft" onclick="button_jump_click('top_all')"></p>
                    <p><input type="button" value="导航关键统计报表" class="buttonLeft" onclick="button_jump_click('kes_stat')"></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:150px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >日志信息查询</a>
                    </div>
                    <p><input type="button" value="错误日志查询" class="buttonLeft" onclick="button_jump_click('error_log')"></p>
                    <p><input type="button" value="cuid查询" class="buttonLeft" onclick="button_jump_click('cuid_log')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >端信息查询</a>
                    </div>
                    <p><input type="button" value="端pv统计"  class="buttonLeft"  onclick="button_jump_click('port_pv')" ></p>
                    <p><input type="button" value="端错误率统计"  class="buttonLeft"  onclick="button_jump_click('port_error')" ></p>
                    <p><input type="button" value="端非法率统计"  class="buttonLeft"  onclick="button_jump_click('port_illegal')" ></p>
                    <p><input type="button" value="端数据量统计"  class="buttonLeft"  onclick="button_jump_click('port_data')" ></p>
                    <p><input type="button" value="端性能统计"  class="buttonLeft"  onclick="button_jump_click('port_performance')" ></p>
                    <p><input type="button" value="偏航统计" class="buttonLeft" onclick="button_jump_click('yawpos_summary')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >version信息查询</a>
                    </div>
                    <p><input type="button" value="version-pv统计"  class="buttonLeft" onclick="button_jump_click('version_pv')" ></p>
                    <p><input type="button" value="version错误率统计"  class="buttonLeft" onclick="button_jump_click('version_error')" ></p>
                    <p><input type="button" value="version非法率统计"  class="buttonLeft" onclick="button_jump_click('version_illegal')" ></p>
                    <p><input type="button" value="version数据量统计" class="buttonLeft"  onclick="button_jump_click('version_data')" ></p>
                    <p><input type="button" value="version性能统计" class="buttonLeft" onclick="button_jump_click('version_performance')" ></p>
                    <p><input type="button" value="模块性能统计" class="buttonLeft" onclick="button_jump_click('module_performance')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:120px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >用户反馈信息查询</a>
                    </div>
                    <p><input type="button" value="用户吐槽类型统计"  class="buttonLeft" onclick="button_jump_click('naviure_type_flag')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >其他信息查询</a>
                    </div>
                    <p><input type="button" value="multinavi session 统计" class="buttonLeft" onclick="button_jump_click('multinavi_session_query')" ></p>
                    <p><input type="button" value="特殊路线pv统计" class="buttonLeft" onclick="button_jump_click('special_route_type_pv')" ></p>
                    <p><input type="button" value="城市query统计" class="buttonLeft" onclick="button_jump_click('city_query')" ></p>
                    <p><input type="button" value="多路线召回信息统计" class="buttonLeft" onclick="button_jump_click('multi_route_recall')" ></p>
                    <p><input type="button" value="导航偏好信息统计" class="buttonLeft" onclick="button_jump_click('navigation_preference')" ></p>
                    <p><input type="button" value="时间评估统计" class="buttonLeft" onclick="button_jump_click('route_time_ratio')" ></p>
                </center>
            </div>
        </div>
        <div class="right" id="div_right">
            <div class="divtool">
                <div class="divtoolname">
                    <a style="font-size:26px">导航统计概览</a>
                </div>
            </div>
            <div class="divcomment">
                <center>
                    <div style="width:100%;background:#cba;">
                        <li style="font-size:20px">过去7天信息统计表</li>
                    <div>
                    <div style="width:100%;background:#ffffff;height:250px">
                        </br>
                        <table id="show_info_table" border=1>
                            
                        </table>
                    </div>
                    <div style="width:100%;background:#cba;">
                        <li style="font-size:20px">端pv统计</li>
                    <div>
                    <div style="width:100%;background:#ffffff">
                        <div id="port_pvn_container" style="float:left;width:50%;height:350px" ></div>
                        <div id="port_pvr_container" style="float:left;width:50%;height:350px;background:#ffffff" ></div>
                    </div>
                    <div style="width:100%;background:#cba;">
                        <li style="font-size:20px">服务性能统计</li>
                    <div>
                    <div style="width:100%;background:#ffffff">
                        <div id="port_time_container" style="float:left;width:50%;height:350px;background:#ffffff" ></div>
                        <div id="port_size_container" style="float:left;width:50%;height:350px" ></div>
                    </div>
                    <div style="width:100%">
                        <div id="ot_ratio_container" style="float:left;width:50%;height:350px;background:#ffffff" ></div>
                        <div style="float:left;width:50%;height:350px;background:#ffffff" ></div>
                    </div>
                    <div style="width:100%;background:#cba;">
                        <li style="font-size:20px">服务质量统计</li>
                    <div>
                    <div style="width:100%;background:#ffffff">
                        <div id="port_err_container" style="float:left;width:50%;height:350px" ></div>
                        <div style="float:left;width:50%;height:350px;background:#ffffff" ></div>
                    </div>
                    <div style="width:100%;background:#cba;">
                        <li style="font-size:20px">城市查询统计</li>
                    <div>
                    <div  style="width:100%;height:600px;background:#ffeeff">
                        <div style="float:left;height:100%;width:20%;background:#ffeeff">
                            <center>
                                <div style="height:10px;width:100%;"></div>
                                <input type="button" value="清空图表" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="city_table_clear_click()" >
                                <div style="height:10px;width:100%;"></div>
                                <table id="table_city_name_list" border=1>
                                </table>
                            </center>
                        </div>
                        <div style="float:right;height:50%;width:80%;background:#0ff">
                            <div id="city_day_num" style="float:left;height:99%;width:49.9%;background:#aaaa00;box-shadow: 0 0 1px #0f0f0f;">
                            
                            </div>
                            <div id="city_day_ratio" style="float:right;height:99%;width:49.9%;background:#0aaaa0;box-shadow: 0 0 1px #0f0f0f;">
                            
                            </div>
                        </div>
                        
                        <div style="float:right;height:50%;width:80%;background:#ff0">
                            <div id="city_week_num" style="float:left;height:99%;width:49.9%;background:#00aaaa;box-shadow: 0 0 1px #0f0f0f;">
                            
                            </div>
                            <div id="city_week_ratio" style="float:right;height:99%;width:49.9%;background:#a00aaa;box-shadow: 0 0 1px #0f0f0f;">
                            
                            </div>
                        </div>
                    </div>
                </center>
            </div>
        </div>
    </form>
</body>


<script type="text/javascript">
    JQ = jQuery.noConflict();
    
    var host_port    = $:global_info ;
    var host        = "http://" + host_port[0] ;
    var port_num    = host_port[1] ;
    
    function button_jump_click( target_page ){
        var url = host + ":" + port_num + "/" + target_page;
        window.open( url , "_self");
    }
    
    var port_name_2_port_name_show = {}
    port_name_2_port_name_show[ "webmap" ] = "webmap";
    port_name_2_port_name_show[ "webapp" ] = "webapp";
    port_name_2_port_name_show[ "webapi" ] = "webapi";
    port_name_2_port_name_show[ "unknown" ] = "来源未知";
    port_name_2_port_name_show[ "baidu_map" ] = "百度地图";
    port_name_2_port_name_show[ "baidu_navi" ] = "百度导航";
    port_name_2_port_name_show[ "navi_sdk" ] = "导航SDK";
    port_name_2_port_name_show[ "other_service" ] = "其他后端服务";
    port_name_2_port_name_show[ "remove_port" ] = "resid不存在";
    
    var port_name_list  = [];
    var port_hour_range = [];
    
    var port_err_data_list  = [];
    var port_time_data_list =[];
    var port_size_data_list = [];
    var port_pvn_data_list  = [];
    var port_pvr_data_list  = [];
    var port_total_pvn_data_list = [];
    var port_total_err_ratio = [];
    var port_total_avg_time  = [];
    var port_total_avg_size  = [];
    
    var port_total_ot_num_list   = [];
    var port_total_ot_ratio_list = [];
    
    var port_dw_err_data_list  = [];
    var port_dw_time_data_list =[];
    var port_dw_size_data_list = [];
    var port_dw_pvn_data_list  = [];
    var port_dw_pvr_data_list  = [];
    var port_dw_total_pvn_data_list = [];
    var port_dw_total_err_ratio = [];
    var port_dw_total_avg_time  = [];
    var port_dw_total_avg_size  = [];
    
    var port_dw_total_ot_num_list   = [];
    var port_dw_total_ot_ratio_list = [];
    
    
    
    
    var cite_name_list        = [];
    var cite_day_hour_range    = [];
    var cite_week_hour_range= [];
    var city_day_data_list    = [];
    var city_week_data_list    = [];
    var city_day_ratio_list    = [];
    var city_week_ratio_list= [];
    
    
    var city_visible_lst    = [];
    var port_name = [];
    
    

    function createStockChart( div_id , title , ytitle , decimals , suffix , ysuffix , mydata , need_point , need_legend ){
        
        JQ('#' + div_id ).highcharts
        (
            {
                chart: {
                    type: 'spline'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: title
                },
                xAxis: {
                    title: {
                        text: "时间轴"
                    },
                    type: 'datetime'
                },
                yAxis: {
                    title: {
                        text: ytitle
                    },
                    labels: {
                        formatter: function() {
                            return this.value + ysuffix
                        }
                    }
                },
                legend: { 
                    enabled: need_legend 
                },
                tooltip: {
                    crosshairs: true,
                    shared: true,
                    useHTML : true,
                    headerFormat : '<small>{point.key}</small><table>',
                    pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + '<td style="text-align:right"><b>{point.y}</b></td></tr>',
                    footerFormat: '</table>',
                    valueDecimals : decimals,
                    valueSuffix: suffix
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: need_point
                        }
                    }
                },
                navigator: {
                    margin: 2,
                    height: 20
                },
                rangeSelector: {
                    enabled: false
                },
                series: mydata
            }
        );
    }
    
    
    function createStockChartDW( div_id , title , ytitle , decimals , suffix , ysuffix , mydata , need_point , extra_name ){
		JQ('#' + div_id ).highcharts
		(
			{
				chart: {
					type: 'spline'
				},
				credits: {
					enabled: false
				},
				title: {
					text: title
				},
				xAxis: {
					type: 'datetime'
				},
				yAxis: {
					title: {
						text: ytitle
					},
					labels: {
						formatter: function() {
							return this.value + ysuffix
						}
					}
                },
				legend: { 
					enabled: true 
				},
				tooltip:{
                    crosshairs: true,
					shared: true,
					useHTML : true,
					headerFormat : '<small>{point.key}</small> 数值 （周的日平均）<table>',
					pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + 
                                    '<td style="text-align:right"><b>{point.y:.' + decimals + 'f}' + suffix + '</b></td>' + 
                                    '<td style="text-align:right"><b>({point.dw:.' + decimals + 'f}' + suffix + ')</b></td></tr>',
					footerFormat: '</table>'
                },
				plotOptions: {
					series: {
						marker: {
							enabled: need_point
						}
					}
				},
				navigator: {
					margin: 2,
					height: 20
				},
				rangeSelector: {
					enabled: false
				},
				series: mydata
			}
		);
	}
    
    
    
    function city_draw_day_table(){
        var start_time     = parseInt( cite_day_hour_range[0] ) * 3600 * 1000;
        var mydata=[];
        for( var i = 0 ; i < cite_name_list.length ; i++ ){
            if( city_visible_lst[i] == true ){
                mydata.push(
                    {
                        name : cite_name_list[i],
                        pointInterval: 24 * 3600 * 1000,
                        pointStart: start_time ,
                        data: city_day_data_list[i]
                    }
                );
            }
        }
        createStockChart( "city_day_num" , "城市query统计（天）" , "请求数目" , 0 , '' , '' , mydata , true , false );
        
        mydata=[];
        for( var i = 0 ; i < cite_name_list.length ; i++ ){
            if( city_visible_lst[i] == true ){
                mydata.push(
                    {
                        name : cite_name_list[i],
                        pointInterval: 24 * 3600 * 1000,
                        pointStart: start_time ,
                        data: city_day_ratio_list[i]
                    }
                );
            }
        }
        createStockChart( "city_day_ratio" , "城市query比例统计（天）" , "请求比例" , 2 , '%' , '%' , mydata , true, false );
    }
    
    
    function city_draw_week_table(){
        var start_time     = parseInt( cite_week_hour_range[0] ) * 3600 * 1000;
        var mydata=[];
        for( var i = 0 ; i < cite_name_list.length ; i++ ){
            if( city_visible_lst[i] == true ){
                mydata.push(
                    {
                        name : cite_name_list[i],
                        pointInterval: 7 * 24 * 3600 * 1000,
                        pointStart: start_time ,
                        data: city_week_data_list[i]
                    }
                );
            }
        }
        createStockChart( "city_week_num" , "城市query统计（周）" , "请求数目" , 0 , '' , '' , mydata ,true, false );
        
        mydata=[];
        for( var i = 0 ; i < cite_name_list.length ; i++ ){
            if( city_visible_lst[i] == true ){
                mydata.push(
                    {
                        name : cite_name_list[i],
                        pointInterval: 7 * 24 * 3600 * 1000,
                        pointStart: start_time ,
                        data: city_week_ratio_list[i]
                    }
                );
            }
        }
        createStockChart( "city_week_ratio" , "城市query比例统计（周）" , "请求比例" , 2 , '%' , '%' , mydata ,true, false );
    }
    

    
    function city_draw_tables(){
        city_draw_day_table();
        city_draw_week_table();
    }
    
    
    function city_table_clear_click( ){
        for( var i = 0 ; i < cite_name_list.length ; i++ ){
            city_visible_lst[i] = false;
            city_id = "city_" + cite_name_list[i];
            var td_obj =  document.getElementById( city_id );
            td_obj.style.backgroundColor = "#ffffee";
        }
        city_draw_tables();
    }
    
    function city_table_on_click( td_id ){
        var td_obj =  document.getElementById( td_id );
        city_name = td_id.split( '_' )[1];
        
        for( var i = 0 ; i < cite_name_list.length ; i++ ){
            if( cite_name_list[i] == city_name ){
                if( city_visible_lst[i] == true ){
                    city_visible_lst[i] = false;
                    td_obj.style.backgroundColor = "#ffffee";
                }else{
                    city_visible_lst[i] = true;
                    td_obj.style.backgroundColor = "#889988";
                }
            }
        }
        city_draw_tables();
    }
    
    
    function draw_all_talbes(){
        var hour_range = port_hour_range;
        var name_list = port_name_list;
        
        var mydata = [];
        var tmp_data = [];
        for( var i = 0 ; i < port_total_err_ratio.length ; i++ ){
            tmp_data.push(
                {
                    y:port_total_err_ratio[i],
                    dw:port_dw_total_err_ratio[i]
                }
            );
        }
        mydata.push(
            {
                name : "总错误率",
                pointInterval: 24 * 3600 * 1000,
                pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                data: tmp_data
            }
        );
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data = [];
            for( var j = 0 ; j < port_err_data_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:port_err_data_list[i][j],
                        dw:port_dw_err_data_list[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: 24 * 3600 * 1000,
                    pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                    data: tmp_data
                }
            );
        }
        createStockChartDW( "port_err_container" , "错误率统计" , "错误率" , 2 , '%' , '%' , mydata , true , true );
        

        mydata = [];
        tmp_data = [];
        for( var i = 0 ; i < port_total_avg_size.length ; i++ ){
            tmp_data.push(
                {
                    y:port_total_avg_size[i],
                    dw:port_dw_total_avg_size[i]
                }
            );
        }
        mydata.push(
            {
                name : "总平均数据量",
                pointInterval: 24 * 3600 * 1000,
                pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                data: tmp_data
            }
        );
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data = [];
            for( var j = 0 ; j < port_size_data_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:port_size_data_list[i][j],
                        dw:port_dw_size_data_list[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: 24 * 3600 * 1000,
                    pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                    data: tmp_data
                }
            );
        }
        createStockChartDW( "port_size_container" , "平均数据量统计" , "平均数据量" , 0 , 'k' , 'k' , mydata , true , true );
        
        
        mydata = [];
        tmp_data = [];
        for( var i = 0 ; i < port_total_avg_time.length ; i++ ){
            tmp_data.push(
                {
                    y:port_total_avg_time[i],
                    dw:port_dw_total_avg_time[i]
                }
            );
        }
        mydata.push(
            {
                name : "总平均用时",
                pointInterval: 24 * 3600 * 1000,
                pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                data: tmp_data
            }
        );
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data = [];
            for( var j = 0 ; j < port_time_data_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:port_time_data_list[i][j],
                        dw:port_dw_time_data_list[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: 24 * 3600 * 1000,
                    pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                    data: tmp_data
                }
            );
        }
        createStockChartDW( "port_time_container" , "平均用时统计" , "平均用时" , 0 , 'ms' , 'ms' , mydata , true , true );

        
        mydata = [];
        tmp_data = [];
        for( var i = 0 ; i < port_total_pvn_data_list.length ; i++ ){
            tmp_data.push(
                {
                    y:port_total_pvn_data_list[i],
                    dw:port_dw_total_pvn_data_list[i]
                }
            );
        }
        mydata.push(
            {
                name : "总体pv",
                pointInterval: 24 * 3600 * 1000,
                pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                data: tmp_data
            }
        );
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data = [];
            for( var j = 0 ; j < port_pvn_data_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:port_pvn_data_list[i][j],
                        dw:port_dw_pvn_data_list[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: 24 * 3600 * 1000,
                    pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                    data: tmp_data
                }
            );
        }
        createStockChartDW( "port_pvn_container" , "端口查询pv" , "查询pv" , 0 , '' , '' , mydata , true , true );
        

        mydata = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            tmp_data = [];
            for( var j = 0 ; j < port_pvr_data_list[i].length ; j++ ){
                tmp_data.push(
                    {
                        y:port_pvr_data_list[i][j],
                        dw:port_dw_pvr_data_list[i][j]
                    }
                );
            }
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: 24 * 3600 * 1000,
                    pointStart: parseInt( hour_range[0] ) * 3600 * 1000 ,
                    data: tmp_data
                }
            );
        }
        createStockChartDW( "port_pvr_container" , "端口查询比例" , "查询比例" , 2 , '%' , '%' , mydata , true , true );
        
        
        
        mydata = [];
        tmp_data = [];
        for( var i = 0 ; i < port_total_ot_num_list.length ; i++ ){
            tmp_data.push(
                {
                    y:port_total_ot_ratio_list[i],
                    num:port_total_ot_num_list[i]
                }
            );
        }
        mydata.push(
            {
                name : "请求超时率(>800ms)",
                pointInterval: 24 * 3600 * 1000 ,
                pointStart: port_hour_range[0] * 3600 * 1000,
                data: tmp_data ,
            }
        );
        JQ('#ot_ratio_container').highcharts
		(
			{
				chart: {
					type: 'spline'
				},
				credits: {
					enabled: false
				},
				title: {
					text: "请求超时率（超时次数/请求次数）统计"
				},
				xAxis: {
					type: 'datetime'
				},
				yAxis: {
					title: {
						text: "请求超时率"
					},
					labels: {
						formatter: function() {
							return this.value + "%";
						}
					}
                },
				legend: { 
					enabled: true 
				},
				tooltip:{
                    crosshairs: true,
					shared: true,
					useHTML : true,
					headerFormat : '<small>{point.key}</small>  超时率 （周的日平均） 次数<table>',
					pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + 
                                    '<td style="text-align:right"><b>{point.y:.2f}%</b></td>' + 
                                    '<td style="text-align:right"><b>({point.dw:.2f}%)</b></td>' + 
                                    '<td style="text-align:right"><b>{point.num}</b></td></tr>',
					footerFormat: '</table>'
                },
				plotOptions: {
					series: {
						marker: {
							enabled: true
						}
					}
				},
				navigator: {
					margin: 2,
					height: 20
				},
				rangeSelector: {
					enabled: false
				},
				series: mydata
			}
		);
        
        
        city_draw_tables();
        
    }
    
   
    function init_data( json_obj ){
        var raw_port_name_list = json_obj["port_info"]["name_list"];
        port_name_list = [];
        for( var i = 0 ; i < raw_port_name_list.length ; i++ ){
            port_name_list.push( port_name_2_port_name_show[ raw_port_name_list[i] ] );
        }
        port_hour_range = json_obj["port_info"]["day_range"];
        port_err_data_list   = json_obj["port_info"]["day_err_ratio"];
        port_time_data_list  = json_obj["port_info"]["day_avg_time"];
        port_size_data_list  = json_obj["port_info"]["day_avg_size"];
        port_pvr_data_list   = json_obj["port_info"]["day_pv_percent"];
        port_pvn_data_list   = json_obj["port_info"]["day_pv_num"];
        port_total_pvn_data_list = json_obj["port_info"]["day_total_pv_list"];
        
        port_total_err_ratio = json_obj["port_info"]["day_total_err_ratio"];
        port_total_avg_time  = json_obj["port_info"]["day_total_avg_time"];
        port_total_avg_size  = json_obj["port_info"]["day_total_avg_size"];
        
        port_total_ot_num_list = json_obj["port_info"]["day_ot_num_list"];
        port_total_ot_ratio_list = json_obj["port_info"]["day_ot_ratio_list"];
        
        
        port_dw_err_data_list   = json_obj["port_info"]["day_week_err_ratio"];
        port_dw_time_data_list  = json_obj["port_info"]["day_week_avg_time"];
        port_dw_size_data_list  = json_obj["port_info"]["day_week_avg_size"];
        port_dw_pvr_data_list   = json_obj["port_info"]["day_week_pv_percent"];
        port_dw_pvn_data_list   = json_obj["port_info"]["day_week_pv_num"];
        port_dw_total_pvn_data_list = json_obj["port_info"]["day_week_total_pv_list"];
        
        port_dw_total_err_ratio = json_obj["port_info"]["day_week_total_err_ratio"];
        port_dw_total_avg_time  = json_obj["port_info"]["day_week_total_avg_time"];
        port_dw_total_avg_size  = json_obj["port_info"]["day_week_total_avg_size"];
        
        port_dw_total_ot_num_list = json_obj["port_info"]["day_week_ot_num_list"];
        port_dw_total_ot_ratio_list = json_obj["port_info"]["day_week_ot_ratio_list"];
        
        cite_name_list         = json_obj["city_num"]["name_list"];
        cite_day_hour_range    = json_obj["city_num"]["day_range"] ;
        cite_week_hour_range   = json_obj["city_num"]["week_range"] ;
        city_day_data_list     = json_obj["city_num"]["day_list"] ;
        city_week_data_list    = json_obj["city_num"]["week_list"] ;
        city_day_ratio_list    = json_obj["city_num"]["day_ratio_list"] ;
        city_week_ratio_list   = json_obj["city_num"]["week_ratio_list"] ;
        
        var port_total_pv_num_list = json_obj["port_info"]["port_total_pv_num_list"]
        var port_total_pv_percent_list = json_obj["port_info"]["port_total_pv_percent_list"]
        var port_total_avg_time_list = json_obj["port_info"]["port_total_avg_time_list"]
        var port_total_avg_size_list = json_obj["port_info"]["port_total_avg_size_list"]
        var port_total_avg_err_ratio_list = json_obj["port_info"]["port_total_avg_err_ratio_list"]
        var port_total_avg_ot_ratio_list = json_obj["port_info"]["port_total_avg_ot_ratio_list"]
        
        var show_info_table_inner_html = "";
        show_info_table_inner_html = show_info_table_inner_html + 
            "<tr>" +
                "<th>端口名</th>" + 
                "<th>周累计pv数目</th>" + 
                "<th>周累计pv比例</th>" + 
                "<th>周平均用时</th>" + 
                "<th>周平均数据量</th>" + 
                "<th>周平均错误率</th>" +
                "<th>周平均超时率</th>" +
            "</tr>";
        for( var i = 0 ; i < port_name_list.length; i++){
            show_info_table_inner_html = show_info_table_inner_html + 
                    "<tr>" +
                        "<td>" + port_name_list[i] + "</td>" +
                        "<td>" + port_total_pv_num_list[i]+ "</td>" +
                        "<td>" + Math.round(port_total_pv_percent_list[i]*100)/100 + "%</td>" +
                        "<td>" + Math.round(port_total_avg_time_list[i]) + "ms</td>" +
                        "<td>" + Math.round(port_total_avg_size_list[i]) + "</td>" +
                        "<td>" + Math.round(port_total_avg_err_ratio_list[i]*100)/100 + "%</td>" +
                        "<td>" + Math.round(port_total_avg_ot_ratio_list[i]*10000)/10000 + "%</td>" +
                    "</tr>";
        }
        document.getElementById("show_info_table").innerHTML = show_info_table_inner_html;
        
        city_visible_lst = [];
        for( var  i  = 0 ; i < cite_name_list.length ; i ++ ){
            city_visible_lst.push( false );
        }
        
        for( var i = 0 ; i < port_total_avg_size.length ; i ++ ){
            port_total_avg_size[i] /= 1000;
            port_dw_total_avg_size[i] /= 1000;
        }
        for( var i = 0 ; i < port_name_list.length; i ++ ){
            for( var j=0;j < port_size_data_list[i].length ; j ++ ){
                port_size_data_list[i][j] /= 1000;
                port_dw_size_data_list[i][j] /= 1000;
            }
        }
        
        var table_city_name_obj = document.getElementById( "table_city_name_list" );
        var inner_html = "";
        inner_html = inner_html +
                    "<tr>" +
                        "<th>城市名称</th>" + 
                        "<th>最后一天查询比例</th>" +
                    "</tr>";
        
        for( var i = 0 ; i < json_obj["city_num"]["name_list"].length ; i++ ){
            var city_name = json_obj["city_num"]["name_list"][i];
            var last_day_ratio = json_obj["city_num"]["day_ratio_list"][i][ json_obj["city_num"]["day_ratio_list"][i].length - 1 ];
            if( city_visible_lst[i] == true ){
                inner_html = inner_html + 
                    "<tr>" +
                        "<td onclick='city_table_on_click(this.id)' id='city_" + city_name + "'>" + city_name + "</td>" +
                        "<td>" + last_day_ratio + "%</td>" +
                    "</tr>";
            }else{
                inner_html = inner_html + 
                    "<tr>" +
                        "<td onclick='city_table_on_click(this.id)' id='city_" + city_name + "'>" + city_name + "</td>" +
                        "<td>" + last_day_ratio + "%</td>" +
                    "</tr>";
            }
        }
    
        table_city_name_obj.innerHTML = inner_html;
        
        
        for( var i = 0 ; i < 3 ; i ++ ){
            city_visible_lst[i] = true;
        }
        
        for( var i = 0 ; i < 3 ; i ++ ){
            var city_id = "city_" + cite_name_list[i];
            var td_obj =  document.getElementById( city_id );
            td_obj.style.backgroundColor = "#889988";
        }
        
    }
    
    
    
    
    var xmlHTTP     = new XMLHttpRequest();
    function query_info_done(){
        if( xmlHTTP.readyState == 4 && xmlHTTP.status == 200){
            json_obj = eval('(' + xmlHTTP.responseText + ')');
            init_data( json_obj );
            draw_all_talbes();
        }
    }



    function search_button_on_click(  ){
        var url = host + ":" + port_num + "/top_all_get_data";
        xmlHTTP.open("POST", url, true);
        xmlHTTP.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xmlHTTP.onreadystatechange = query_info_done;
        xmlHTTP.send( "" );
    }
    
    search_button_on_click();
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
</script>

</html>
