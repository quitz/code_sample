$def with( global_info)

<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>偏航统计</title>
    
    <script src="/static/js/jquery.min.js"></script>    
    <script src="/static/js/highstock.js"></script>
    <script src="/static/js/exporting.js"></script> 
    <script src="/static/js/jquery.min.map"></script>   
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.core.js"></script>
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.widget.js"></script>
    <script src="/static/jquery-ui-1.10.3/ui/jquery.ui.datepicker.js"></script>
    <link rel="stylesheet" href="/static/jquery-ui-1.10.3/themes/base/jquery.ui.all.css">
    <link rel="stylesheet" href="/static/jquery-ui-1.10.3/demos/demos.css">
    <style type="text/css">
        html,body
        {
            height: 100%;
            margin: 0;
            
        }
        .left
        {
            float: left;
            height: 6000px;
            width: 200px;
            background:#88ee88;
            border: 5px solid #88ee88 ;
        }
        .right
        {
            margin-left:210px; 
            height: 6000px;
            width: 1100px;
            background:#eeffee;
            border: 3px solid #80e080 ;
        }  
        .divtool
        {
            width: 100%;
            height: 100px;
            box-shadow: 0 0 1px #0f0f0f;
        }
        .divcomment
        {
            width: 100%;
            height: 5900px ;
            background:#ffffee ;
        }
        .divtoolname
        {
            width: 100%;
            height: 35%;
            text-align:center;
            background:#ccffdd;
            box-shadow: 0 0 3px #0f0f0f;
        }
        .divtooltools
        {
            width: 100%;
            height: 63%;
            box-shadow: 0 0 3px #0f0f0f;
        }
        .buttonLeft
        {
            width:80%;
            height:30px;
            box-shadow: 0 0 1px #0f0f0f;
        }
    </style>
</head>
<body>
    <form id="log_form" method="POST">
        <div class="left" id="div_left">
            <div style="width:100%;height:130px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >概览信息</a>
                    </div>
                    <p><input type="button" value="导航统计概览" class="buttonLeft" onclick="button_jump_click('top_all')"></p>
                    <p><input type="button" value="导航关键统计报表" class="buttonLeft" onclick="button_jump_click('kes_stat')"></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:150px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >日志信息查询</a>
                    </div>
                    <p><input type="button" value="错误日志查询" class="buttonLeft" onclick="button_jump_click('error_log')"></p>
                    <p><input type="button" value="cuid查询" class="buttonLeft" onclick="button_jump_click('cuid_log')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >端信息查询</a>
                    </div>
                    <p><input type="button" value="端pv统计"  class="buttonLeft"  onclick="button_jump_click('port_pv')" ></p>
                    <p><input type="button" value="端错误率统计"  class="buttonLeft"  onclick="button_jump_click('port_error')" ></p>
                    <p><input type="button" value="端非法率统计"  class="buttonLeft"  onclick="button_jump_click('port_illegal')" ></p>
                    <p><input type="button" value="端数据量统计"  class="buttonLeft"  onclick="button_jump_click('port_data')" ></p>
                    <p><input type="button" value="端性能统计"  class="buttonLeft"  onclick="button_jump_click('port_performance')" ></p>
                    <p><input type="button" value="偏航统计" class="buttonLeft" onclick="button_jump_click('yawpos_summary')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >version信息查询</a>
                    </div>
                    <p><input type="button" value="version-pv统计"  class="buttonLeft" onclick="button_jump_click('version_pv')" ></p>
                    <p><input type="button" value="version错误率统计"  class="buttonLeft" onclick="button_jump_click('version_error')" ></p>
                    <p><input type="button" value="version非法率统计"  class="buttonLeft" onclick="button_jump_click('version_illegal')" ></p>
                    <p><input type="button" value="version数据量统计" class="buttonLeft"  onclick="button_jump_click('version_data')" ></p>
                    <p><input type="button" value="version性能统计" class="buttonLeft" onclick="button_jump_click('version_performance')" ></p>
                    <p><input type="button" value="模块性能统计" class="buttonLeft" onclick="button_jump_click('module_performance')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:120px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >用户反馈信息查询</a>
                    </div>
                    <p><input type="button" value="用户吐槽类型统计"  class="buttonLeft" onclick="button_jump_click('naviure_type_flag')" ></p>
                </center>
            </div>
            </br>
            <div style="width:100%;height:300px;background:#ccbbdd;box-shadow: 0 0 3px #000;">
                <center>
                    <div style="width:100%;height:40px;background:#abcdef;">
                        <a style="font-size:25px;" >其他信息查询</a>
                    </div>
                    <p><input type="button" value="multinavi session 统计" class="buttonLeft" onclick="button_jump_click('multinavi_session_query')" ></p>
                    <p><input type="button" value="特殊路线pv统计" class="buttonLeft" onclick="button_jump_click('special_route_type_pv')" ></p>
                    <p><input type="button" value="城市query统计" class="buttonLeft" onclick="button_jump_click('city_query')" ></p>
                    <p><input type="button" value="多路线召回信息统计" class="buttonLeft" onclick="button_jump_click('multi_route_recall')" ></p>
                    <p><input type="button" value="导航偏好信息统计" class="buttonLeft" onclick="button_jump_click('navigation_preference')" ></p>
                    <p><input type="button" value="时间评估统计" class="buttonLeft" onclick="button_jump_click('route_time_ratio')" ></p>
                </center>
            </div>
        </div>
        <div class="right" id="div_right">
            <div class="divtool">
                <div class="divtoolname">
                    <a style="font-size:20px">偏航统计</a>
                    
                </div>
                <div class="divtooltools">
                    <div style="margin-left:2px;float:left;width:250px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >时间选择 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            From: <input type="text" id="datepicker_from" name="datepicker_from" style="width:80px"">
                            To: <input type="text" id="datepicker_to" name="datepicker_to" style="width:80px">
                        </center>
                    </div>
                    <div style="margin-left:3px;float:left;width:120px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >查询操作 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            <input type="button" value="查询" name="Button_Search" id="Button_Search" onclick="search_button_on_click()" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" >
                        </center>
                    </div>
                    <div style="margin-left:3px;float:left;width:360px;height:98%;background:#bcdeff;box-shadow: 0 0 1px #000;">
                        <center>
                            <div style="width:100%;height:22px;background:#abcdef;">
                                <a style="font-size:20px;" >展示选项 </a>
                            </div>
                            <div style="width:100%;height:5px;"></div>
                            <input type="button" id="button_hour" name="button_hour" value="按小时展示" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="button_hour_click()" >
                            <input type="button" id="button_day" name="button_day" value="按天数展示" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="button_day_click()" >
                            <input type="button" id="button_week" name="button_week" value="按周展示" style="width:100px;height:25px;box-shadow: 0 0 1px #0f0f0f;" onclick="button_week_click()" >
                        </center>
                    </div>
                </div>
            </div>
            <div class="divcomment">
                <br/>
                <center>
                    <div style="width:100%;height:1600px">
                        <div style="width:100%;height:20px;background:#eaf">
                            <a style="font-size:16px">偏航率&偏航比例</a>
                        </div>
                        <div style="width:100%;height:388px;background:#000">
                            <div id="yaw_all_port_ratio" style="width:49.9%;float:left;height:100%;background:#800" ></div>
                            <div id="yaw_all_port_percent" style="width:49.9%;float:right;height:100%;background:#a00" ></div>
                        </div>
                        <div style="width:100%;height:2px;background:#000">
                        </div>
                        <div style="width:100%;height:388px;background:#000">
                            <div id="yaw_all_port_num" style="width:49.9%;float:left;height:100%;background:#080" ></div>
                            <div id="yaw_all_port_colum" style="width:49.9%;float:right;height:100%;background:#0a0" ></div>
                        </div>
                        <div style="width:100%;height:2px;background:#000">
                        </div>
                        <div style="width:100%;height:20px;background:#eaf">
                            <a style="font-size:16px">偏航类型</a>
                        </div>
                        <div style="width:100%;height:388px;background:#000">
                            <div id="yaw_type_count" style="width:49.9%;float:left;height:100%;background:#800" ></div>
                            <div id="yaw_type_percent" style="width:49.9%;float:right;height:100%;background:#a00" ></div>
                        </div>
                        <div style="width:100%;height:2px;background:#000">
                        </div>
                        <div style="width:100%;height:388px;background:#000">
                            <div id="yaw_type_all_count" style="width:49.9%;float:left;height:100%;background:#800" ></div>
                            <div id="yaw_type_ratio" style="width:49.9%;float:right;height:100%;background:#a00" ></div>
                        </div>
                    </div>
                    <div style="width:100%;height:30px;">
                    </div>
                    <div style="width:100%;height:20px;background:#008">
                    </div>
                    <div style="width:100%;height:50px;background:#aef">
                        <a style="font-size:20px">偏航率&偏航比例查询 , 端口选择：</a>
                        <select name="select_port_name" id="select_port_name">
                        </select>
                        <input type="button" value="端口偏航信息查询" onclick="button_port_yaw_info_click()" >
                    </div>
                    <div style="width:100%;height:20px;background:#eaf">
                        <a style="font-size:16px">偏航率&偏航比例</a>
                    </div>
                    <div style="width:100%;height:800px">
                        <div style="width:100%;height:398px;background:#000">
                            <div id="yaw_one_port_ratio" style="width:49.9%;float:left;height:100%;background:#800" ></div>
                            <div id="yaw_one_port_percent" style="width:49.9%;float:right;height:100%;background:#a00" ></div>
                        </div>
                        <div style="width:100%;height:2px;background:#000">
                        </div>
                        <div style="width:100%;height:398px;background:#000">
                            <div id="yaw_one_port_num" style="width:49.9%;float:left;height:100%;background:#080" ></div>
                            <div id="yaw_one_port_colum" style="width:49.9%;float:right;height:100%;background:#0a0" ></div>
                        </div>
                        <div style="width:100%;height:2px;background:#000">
                        </div>
                    </div>
                    <div id="div_yaw_port_type_info_title" style="width:100%;height:20px;background:#eaf">
                        <a style="font-size:16px">偏航类型</a>
                    </div>
                    <div id="div_yaw_port_type_info" style="width:100%;height:800px">
                        <div style="width:100%;height:388px;background:#000">
                            <div id="yaw_port_type_count" style="width:49.9%;float:left;height:100%;background:#800" ></div>
                            <div id="yaw_port_type_percent" style="width:49.9%;float:right;height:100%;background:#a00" ></div>
                        </div>
                        <div style="width:100%;height:2px;background:#000">
                        </div>
                        <div style="width:100%;height:388px;background:#000">
                            <div id="yaw_port_type_all_count" style="width:49.9%;float:left;height:100%;background:#800" ></div>
                            <div id="yaw_port_type_ratio" style="width:49.9%;float:right;height:100%;background:#a00" ></div>
                        </div>
                    </div>
                        
                </center>
                </br>
                
            </div>
        </div>
    </form>
</body>


<script type="text/javascript">
    JQ = jQuery.noConflict();
    
    var host_port   = $:global_info ;
    var host        = "http://" + host_port[0] ;
    var port_num    = host_port[1] ;
    function button_jump_click( target_page ){
        var url = host + ":" + port_num + "/" + target_page;
        window.open( url , "_self");
    }
    
    
    
    JQ(function() {
        JQ( "#datepicker_from" ).datepicker();
    });
    
    JQ(function() {
        JQ( "#datepicker_to" ).datepicker();
    });
    

    var data_dict = {};
    var port_data_dict = {};
    var show_type = "day";
    
    
    var port_number2port_name = {};
    port_number2port_name[ "webmap" ] = "webmap";
    port_number2port_name[ "webapp" ] = "webapp";
    port_number2port_name[ "webapi" ] = "webapi";
    port_number2port_name[ "unknown" ] = "来源未知";
    port_number2port_name[ "baidu_map" ] = "百度地图";
    port_number2port_name[ "baidu_navi" ] = "百度导航";
    port_number2port_name[ "navi_sdk" ] = "导航SDK";
    port_number2port_name[ "other_service" ] = "其他后端服务";
    port_number2port_name[ "remove_port" ] = "缺失resid";


    var port_str2port_name = {};
    port_str2port_name[ "baidu-map" ]  = "百度地图";
    port_str2port_name[ "baidu-navi" ] = "百度导航";
    port_str2port_name[ "baidu-sdk" ]  = "导航SDK";
    port_str2port_name[ "unknown" ]    = "来源未知";
    
    
    var port_number2port_str = {};
    port_number2port_str[ "baidu_map" ]  = "baidu-map";
    port_number2port_str[ "unknown" ]    = "unknown";
    port_number2port_str[ "baidu_navi" ] = "baidu-navi";
    port_number2port_str[ "navi_sdk" ]   = "baidu-sdk";
    
    
    var yaw_type_str2show_name = {};
    yaw_type_str2show_name[ "start_yaw" ]  = "起点偏航";
    yaw_type_str2show_name[ "center_yaw" ]  = "过程偏航";
    yaw_type_str2show_name[ "end_yaw" ]  = "终点偏航";
    
    

    var port_name_select_obj = document.getElementById("select_port_name");
    
    
    function createStockChart( div_id , title , ytitle , decimals , suffix , ysuffix , mydata , need_point ){
        JQ('#' + div_id ).highcharts
        (
            'StockChart',
            {
                chart: {
                    type: 'spline'
                },
                credits: {
                    enabled: false
                },
                title: {
                    text: title
                },
                xAxis: {
                    type: 'datetime'
                },
                yAxis: {
                    title: {
                        text: ytitle
                    },
                    labels: {
                        formatter: function() {
                            return this.value + ysuffix
                        }
                    }
                },
                legend: { 
                    enabled: true 
                },
                tooltip: {
                    crosshairs: true,
                    shared: true,
                    useHTML : true,
                    headerFormat : '<small>{point.key}</small><table>',
                    pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + '<td style="text-align:right"><b>{point.y}</b></td></tr>',
                    footerFormat: '</table>',
                    valueDecimals : decimals,
                    valueSuffix: suffix
                },
                plotOptions: {
                    series: {
                        marker: {
                            enabled: need_point
                        }
                    }
                },
                navigator: {
                    margin: 2,
                    height: 20
                },
                rangeSelector: {
                    enabled: false
                },
                series: mydata
            }
        );
    }
    
    
    
    function createStockChartWeekExtra( div_id , title , ytitle , decimals , suffix , ysuffix , mydata , need_point ){
		JQ('#' + div_id ).highcharts
		(
			'StockChart',
			{
				chart: {
					type: 'spline'
				},
				credits: {
					enabled: false
				},
				title: {
					text: title
				},
				xAxis: {
					type: 'datetime'
				},
				yAxis: {
					title: {
						text: ytitle
					},
					labels: {
						formatter: function() {
							return this.value + ysuffix
						}
					}
                },
				legend: { 
					enabled: true 
				},
				tooltip:{
                    crosshairs: true,
					shared: true,
					useHTML : true,
					headerFormat : '<small>{point.key}</small></br>名称：数值（周的日平均）<table>',
					pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + 
                                    '<td style="text-align:right"><b>{point.y:.'+ decimals + 'f}' + suffix + '</b></td>' + 
                                    '<td style="text-align:right"><b>({point.extra:.'+ decimals + 'f}' + suffix + ')</b></td></tr>',
					footerFormat: '</table>'
                },
				plotOptions: {
					series: {
						marker: {
							enabled: need_point
						}
					}
				},
				navigator: {
					margin: 2,
					height: 20
				},
				rangeSelector: {
					enabled: false
				},
				series: mydata
			}
		);
	}
    
    
    function createColumn( div_id , title , ytitle , x_cate , decimals , suffix , ysuffix , mydata ){
		JQ('#' + div_id ).highcharts
		(
            {
                chart: {
                    type: 'column'
                },
                credits: { 
                    enabled: false 
                },
                title: {
                    text: title
                },
                xAxis: {
                    categories: x_cate
                },
                yAxis: {
                    title: {
                        text: ytitle
                    },
                    labels: {
                        formatter: function() {
                            return this.value + ysuffix;
                        }
                    }
                },
                tooltip: {
                    crosshairs: true,
                    shared: true,
                    useHTML : true,
                    headerFormat : '<small>{point.key}</small><table>',
                    pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + '<td style="text-align:right"><b>{point.y}</b></td></tr>',
                    footerFormat: '</table>',
                    valueDecimals : decimals,
                    valueSuffix: suffix
                },
                series: mydata
            }
		);
	}
    
    function createPie( div_id , title , mycolors , decimals , suffix , mydata ){
        JQ('#' + div_id ).highcharts(
            {
                title: { 
                    text: title 
                },
                tooltip: {
                    crosshairs: true,
                    shared: true,
                    useHTML : true,
                    headerFormat : '<small>{point.key}</small><table>',
                    pointFormat : '<tr><td style="color:{series.color}">{series.name}:</td>' + '<td style="text-align:right"><b>{point.y}</b></td></tr>',
                    footerFormat: '</table>',
                    valueDecimals : decimals,
                    valueSuffix: suffix
                },
                colors: mycolors,
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer'
                    }
                },
                series: mydata
            }
        );
	}
    
    
    function draw_yaw_num_all_tables(){
        var dict = data_dict["yaw_dict"];
        var raw_name_list      = dict["name_list"];
        var name_list = [];
        for( var i = 0 ; i < raw_name_list.length ; i++ ){
            name_list.push( port_number2port_name[ raw_name_list[i] ] );
        }
        var all_yaw_ratio = dict["all_yaw_ratio"];
        var all_yaw_percent = dict["all_yaw_percent"];
        
        var start_time     = parseInt( dict["week_range"][0] ) * 3600 * 1000;
        var point_interval = 7 * 24 * 3600 * 1000;
        var yaw_num_list = dict["week_yaw_num"];
        var yaw_percent_list = dict["week_yaw_percent"];
        var yaw_ratio_list = dict["week_yaw_ratio"];
        var yaw_total_num = dict["week_total_yaw_num"];
        var yaw_total_ratio = dict["week_total_yaw_ratio"];
        var need_point = true;
        
        var show_week_day_yaw_num   = dict["week_day_yaw_num"];
        var show_week_day_yaw_ratio   = dict["week_day_yaw_ratio"];
        var show_week_day_yaw_percent   = dict["week_day_yaw_percent"];
        var show_week_day_total_yaw_num   = dict["week_day_total_yaw_num"];
        var show_week_day_total_yaw_ratio   = dict["week_day_total_yaw_ratio"];
        
        if( show_type == "day" ){
            start_time     = parseInt( dict["day_range"][0] ) * 3600 * 1000;
            point_interval = 24 * 3600 * 1000;
            yaw_num_list = dict["day_yaw_num"];
            yaw_percent_list = dict["day_yaw_percent"];
            yaw_ratio_list = dict["day_yaw_ratio"];
            yaw_total_num = dict["day_total_yaw_num"];
            yaw_total_ratio = dict["day_total_yaw_ratio"];
            show_week_day_yaw_num   = dict["day_week_yaw_num"];
            show_week_day_yaw_ratio   = dict["day_week_yaw_ratio"];
            show_week_day_yaw_percent   = dict["day_week_yaw_percent"];
            show_week_day_total_yaw_num   = dict["day_week_total_yaw_num"];
            show_week_day_total_yaw_ratio   = dict["day_week_total_yaw_ratio"];
            need_point = true;
        }else if( show_type == "hour" ){
            start_time     = parseInt( dict["hour_range"][0] ) * 3600 * 1000;
            point_interval = 3600 * 1000;
            yaw_num_list = dict["hour_yaw_num"];
            yaw_percent_list = dict["hour_yaw_percent"];
            yaw_ratio_list = dict["hour_yaw_ratio"];
            yaw_total_num = dict["hour_total_yaw_num"];
            yaw_total_ratio = dict["hour_total_yaw_ratio"];
            show_week_day_yaw_num   = [];
            show_week_day_yaw_ratio   = [];
            show_week_day_yaw_percent   = [];
            show_week_day_total_yaw_num   = [];
            show_week_day_total_yaw_ratio   = [];
            need_point = false;
        }
        
        var mydata = [];
        if( show_type == "hour" ){
            mydata.push(
                {
                    name : "总偏航率" ,
                    pointInterval: point_interval ,
                    pointStart: start_time ,
                    data: yaw_total_ratio
                }
            );
            for( var i = 0 ; i < name_list.length ; i++ ){
                mydata.push(
                    {
                        name : name_list[i] ,
                        pointInterval: point_interval ,
                        pointStart: start_time ,
                        data: yaw_ratio_list[i]
                    }
                );
            }
            createStockChart( "yaw_all_port_ratio" , "偏航比例统计（偏航次数/请求次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
            
            mydata=[];
            for( var i = 0 ; i < name_list.length ; i++ ){
                mydata.push(
                    {
                        name : name_list[i] ,
                        pointInterval: point_interval ,
                        pointStart: start_time ,
                        data: yaw_percent_list[i]
                    }
                );
            }
            createStockChart( "yaw_all_port_percent" , "偏航比例统计（偏航次数/总偏航次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
            
            mydata=[];
            mydata.push(
                {
                    name : "总偏航数" ,
                    pointInterval: point_interval ,
                    pointStart: start_time ,
                    data: yaw_total_num
                }
            );
            for( var i = 0 ; i < name_list.length ; i++ ){
                mydata.push(
                    {
                        name : name_list[i] ,
                        pointInterval: point_interval ,
                        pointStart: start_time ,
                        data: yaw_num_list[i]
                    }
                );
            }
            createStockChart( "yaw_all_port_num" , "偏航次数" , "偏航次数" , 0 , '' , '' , mydata , need_point );
            
        }else{
            var tmp_data = [];
            for( var j = 0 ; j < yaw_total_ratio.length ; j++ ){
                tmp_data.push(
                    {
                        y:yaw_total_ratio[j],
                        extra:show_week_day_total_yaw_ratio[j]
                    }
                );
            }
            mydata.push(
                {
                    name : "总偏航率",
                    pointInterval: point_interval,
                    pointStart: start_time ,
                    data: tmp_data
                }
            );
            for( var i = 0 ; i < name_list.length ; i++ ){
                var tmp_data = [];
                for( var j = 0 ; j < yaw_ratio_list[i].length ; j++ ){
                    tmp_data.push(
                        {
                            y:yaw_ratio_list[i][j],
                            extra:show_week_day_yaw_ratio[i][j]
                        }
                    );
                }
                mydata.push(
                    {
                        name : name_list[i] ,
                        pointInterval: point_interval ,
                        pointStart: start_time ,
                        data: tmp_data
                    }
                );
            }
            createStockChartWeekExtra( "yaw_all_port_ratio" , "偏航比例统计（偏航次数/请求次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
            
            mydata=[];
            for( var i = 0 ; i < name_list.length ; i++ ){
                var tmp_data = [];
                for( var j = 0 ; j < yaw_percent_list[i].length ; j++ ){
                    tmp_data.push(
                        {
                            y:yaw_percent_list[i][j],
                            extra:show_week_day_yaw_percent[i][j]
                        }
                    );
                }
                mydata.push(
                    {
                        name : name_list[i] ,
                        pointInterval: point_interval ,
                        pointStart: start_time ,
                        data: tmp_data
                    }
                );
            }
            createStockChartWeekExtra( "yaw_all_port_percent" , "偏航比例统计（偏航次数/总偏航次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
            
            mydata=[];
            tmp_data = [];
            for( var j = 0 ; j < yaw_total_num.length ; j++ ){
                tmp_data.push(
                    {
                        y:yaw_total_num[j],
                        extra:show_week_day_total_yaw_num[j]
                    }
                );
            }
            mydata.push(
                {
                    name : "总偏航数" ,
                    pointInterval: point_interval ,
                    pointStart: start_time ,
                    data: tmp_data
                }
            );
            for( var i = 0 ; i < name_list.length ; i++ ){
                var tmp_data = [];
                for( var j = 0 ; j < yaw_num_list[i].length ; j++ ){
                    tmp_data.push(
                        {
                            y:yaw_num_list[i][j],
                            extra:show_week_day_yaw_num[i][j]
                        }
                    );
                }
                mydata.push(
                    {
                        name : name_list[i] ,
                        pointInterval: point_interval ,
                        pointStart: start_time ,
                        data: tmp_data
                    }
                );
            }
            createStockChartWeekExtra( "yaw_all_port_num" , "偏航次数" , "偏航次数" , 0 , '' , '' , mydata , need_point );
        }
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    data: [ all_yaw_ratio[i] , all_yaw_percent[i] ]
                }
            );
        }
        
        createColumn( "yaw_all_port_colum" , "偏航比例分布" , "偏航比例" , 
                    [ "偏航比例（偏航次数/请求次数）" , "偏航比例（偏航次数/总偏航次数）" ]  , 2 , "%" , "%" , mydata );
        
        
    }
    
    
    
    function draw_yaw_type_all_tables(  ){
        
        var div_yaw_type_count = "yaw_type_count";
        var div_yaw_type_percent = "yaw_type_percent";
        var div_yaw_type_all_count = "yaw_type_all_count";
        var div_yaw_type_ratio = "yaw_type_ratio";
        
        var dict = data_dict["type_dict"];
        var raw_name_list   = dict["name_list"];
        var name_list = [];
        for( var i = 0 ; i < raw_name_list.length ; i++ ){
            name_list.push( yaw_type_str2show_name[ raw_name_list[i] ] );
        }
        
        
        var start_time  = parseInt( dict["hour_range"][0] ) * 3600 * 1000;
        var pInterval   = 3600 * 1000;
        var yaw_type_count_data = dict["hour_count_list"];
        var yaw_type_ratio_data = dict["hour_yaw_ratio"];
        var yaw_type_percent_data = dict["hour_yaw_percent"];
        var need_point  = false;
        if( show_type == "day" ){
            start_time  = parseInt( dict["day_range"][0] ) * 3600 * 1000;
            pInterval   = 24 * 3600 * 1000;
            yaw_type_count_data = dict["day_count_list"];
            yaw_type_ratio_data = dict["day_yaw_ratio"];
            yaw_type_percent_data = dict["day_yaw_percent"];
            need_point  = true;
        }else if( show_type == "week" ){
            start_time  = parseInt( dict["week_range"][0] ) * 3600 * 1000;
            pInterval   = 7 * 24 * 3600 * 1000;
            yaw_type_count_data = dict["week_count_list"];
            yaw_type_ratio_data = dict["week_yaw_ratio"];
            yaw_type_percent_data = dict["week_yaw_percent"];
            need_point  = true;
        }
        
        var mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: pInterval ,
                    pointStart: start_time ,
                    data: yaw_type_count_data[i]
                }
            );
        }
        createStockChart( div_yaw_type_count , "偏航类型次数统计" , "偏航次数" , 0 , '' , '' , mydata , need_point );
        
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: pInterval ,
                    pointStart: start_time ,
                    data: yaw_type_percent_data[i]
                }
            );
        }
        createStockChart( div_yaw_type_percent , "偏航类型比例统计（偏航次数/总偏航次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
        
        
        mydata=[
            {
                type: 'pie',
                name: '偏航次数',
                data: [
                    [ name_list[0] , dict["all_count_list"][0] ],
                    [ name_list[1] , dict["all_count_list"][1] ],
                    [ name_list[2] , dict["all_count_list"][2] ]
                ]
            }
        ];
        createPie( div_yaw_type_all_count , "偏航类型次数分布" , [ "red" , "blue" , "green" ] , 0 , "" , mydata );
        
        
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: pInterval ,
                    pointStart: start_time ,
                    data: yaw_type_ratio_data[i]
                }
            );
        }
        createStockChart( div_yaw_type_ratio , "偏航类型偏航率统计（偏航次数/请求次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
        
    }
    
    
    function draw_yaw_num_one_port_tables(){
        var dict = port_data_dict["yaw_dict"];
        var name_list   = dict["name_list"];
        var all_yaw_ratio = dict["all_yaw_ratio"];
        var all_yaw_percent = dict["all_yaw_percent"];
        
        var start_time     = parseInt( dict["week_range"][0] ) * 3600 * 1000;
        var point_interval = 7 * 24 * 3600 * 1000;
        var yaw_num_list = dict["week_yaw_num"];
        var yaw_percent_list = dict["week_yaw_percent"];
        var yaw_ratio_list = dict["week_yaw_ratio"];
        var need_point = true;
        
        if( show_type == "day" ){
            start_time     = parseInt( dict["day_range"][0] ) * 3600 * 1000;
            point_interval = 24 * 3600 * 1000;
            yaw_num_list = dict["day_yaw_num"];
            yaw_percent_list = dict["day_yaw_percent"];
            yaw_ratio_list = dict["day_yaw_ratio"];
            need_point = true;
        }else if( show_type == "hour" ){
            start_time     = parseInt( dict["hour_range"][0] ) * 3600 * 1000;
            point_interval = 3600 * 1000;
            yaw_num_list = dict["hour_yaw_num"];
            yaw_percent_list = dict["hour_yaw_percent"];
            yaw_ratio_list = dict["hour_yaw_ratio"];
            need_point = false;
        }
        
        var mydata = [];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i] ,
                    pointInterval: point_interval ,
                    pointStart: start_time ,
                    data: yaw_ratio_list[i]
                }
            );
        }
        createStockChart( "yaw_one_port_ratio" , "偏航比例统计（偏航次数/请求次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i] ,
                    pointInterval: point_interval ,
                    pointStart: start_time ,
                    data: yaw_percent_list[i]
                }
            );
        }
        createStockChart( "yaw_one_port_percent" , "偏航比例统计（偏航次数/总偏航次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i] ,
                    pointInterval: point_interval ,
                    pointStart: start_time ,
                    data: yaw_num_list[i]
                }
            );
        }
        createStockChart( "yaw_one_port_num" , "偏航次数" , "偏航次数" , 0 , '' , '' , mydata , need_point );
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    data: [ all_yaw_ratio[i] , all_yaw_percent[i] ]
                }
            );
        }
        
        createColumn( "yaw_one_port_colum" , "偏航比例分布" , "偏航比例" , 
                    [ "偏航比例（偏航次数/请求次数）" , "偏航比例（偏航次数/总偏航次数）" ]  , 2 , "%" , "%" , mydata );
        
        
    }
    
    
    
    function draw_yaw_type_one_port_tables(  ){
        var div_yaw_type_count = "yaw_port_type_count";
        var div_yaw_type_percent = "yaw_port_type_percent";
        var div_yaw_type_all_count = "yaw_port_type_all_count";
        var div_yaw_type_ratio = "yaw_port_type_ratio";
        
        var dict = port_data_dict["type_dict"];
        if( dict["data_len"] > 0 ){
            document.getElementById("div_yaw_port_type_info").style.display="block" ;
            document.getElementById("div_yaw_port_type_info_title").style.display="block" ;
        }
        
        
        var raw_name_list   = dict["name_list"];
        var name_list = [];
        for( var i = 0 ; i < raw_name_list.length ; i++ ){
            name_list.push( yaw_type_str2show_name[ raw_name_list[i] ] );
        }
        
        
        var start_time  = parseInt( dict["hour_range"][0] ) * 3600 * 1000;
        var pInterval   = 3600 * 1000;
        var yaw_type_count_data = dict["hour_count_list"];
        var yaw_type_ratio_data = dict["hour_yaw_ratio"];
        var yaw_type_percent_data = dict["hour_yaw_percent"];
        var need_point  = false;
        if( show_type == "day" ){
            start_time  = parseInt( dict["day_range"][0] ) * 3600 * 1000;
            pInterval   = 24 * 3600 * 1000;
            yaw_type_count_data = dict["day_count_list"];
            yaw_type_ratio_data = dict["day_yaw_ratio"];
            yaw_type_percent_data = dict["day_yaw_percent"];
            need_point  = true;
        }else if( show_type == "week" ){
            start_time  = parseInt( dict["week_range"][0] ) * 3600 * 1000;
            pInterval   = 7 * 24 * 3600 * 1000;
            yaw_type_count_data = dict["week_count_list"];
            yaw_type_ratio_data = dict["week_yaw_ratio"];
            yaw_type_percent_data = dict["week_yaw_percent"];
            need_point  = true;
        }
        
        var mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: pInterval ,
                    pointStart: start_time ,
                    data: yaw_type_count_data[i]
                }
            );
        }
        createStockChart( div_yaw_type_count , "偏航类型次数统计" , "偏航次数" , 0 , '' , '' , mydata , need_point );
        
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: pInterval ,
                    pointStart: start_time ,
                    data: yaw_type_percent_data[i]
                }
            );
        }
        createStockChart( div_yaw_type_percent , "偏航类型比例统计（偏航次数/总偏航次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
        
        
        mydata=[
            {
                type: 'pie',
                name: '偏航次数',
                data: [
                    [ name_list[0] , dict["all_count_list"][0] ],
                    [ name_list[1] , dict["all_count_list"][1] ],
                    [ name_list[2] , dict["all_count_list"][2] ]
                ]
            }
        ];
        createPie( div_yaw_type_all_count , "偏航类型次数分布" , [ "red" , "blue" , "green" ] , 0 , "" , mydata );
        
        
        
        mydata=[];
        for( var i = 0 ; i < name_list.length ; i++ ){
            mydata.push(
                {
                    name : name_list[i],
                    pointInterval: pInterval ,
                    pointStart: start_time ,
                    data: yaw_type_ratio_data[i]
                }
            );
        }
        createStockChart( div_yaw_type_ratio , "偏航类型偏航率统计（偏航次数/请求次数）" , "偏航比例" , 2 , '%' , '%' , mydata , need_point );
        
    }
    
    
    
    function draw_all_tables(){
        draw_yaw_num_all_tables();
        draw_yaw_type_all_tables();
        draw_yaw_num_one_port_tables();
        draw_yaw_type_one_port_tables();
    }
    
    
    function button_hour_click(){
        show_type = "hour";
        draw_yaw_num_all_tables();
        draw_yaw_type_all_tables();
        draw_yaw_num_one_port_tables();
        draw_yaw_type_one_port_tables();
    }
    
    
    function button_day_click(){
        show_type = "day";
        draw_yaw_num_all_tables();
        draw_yaw_type_all_tables();
        draw_yaw_num_one_port_tables();
        draw_yaw_type_one_port_tables();
    }
    
    function button_week_click(){
        show_type = "week" ;
        draw_yaw_num_all_tables();
        draw_yaw_type_all_tables();
        draw_yaw_num_one_port_tables();
        draw_yaw_type_one_port_tables();
    }
    
    
    function init_data(){
        var inner_html = "";
        var name_list = data_dict['yaw_dict']['name_list'];
        for( var i = 0 ; i < name_list.length ; i++ ){
            inner_html = inner_html +
                "<option value ='" + name_list[i] + "'>" + port_number2port_name[ name_list[i] ] + "</option>";
        }
        port_name_select_obj.innerHTML = inner_html;
    }
    
    var xmlHTTP     = new XMLHttpRequest();
    function query_info_done(){
        if( xmlHTTP.readyState == 4 && xmlHTTP.status == 200){
            json_obj = eval('(' + xmlHTTP.responseText + ')');
            data_dict = json_obj;
            document.getElementById("datepicker_from").value = data_dict['yaw_dict']['date_from'];
            document.getElementById("datepicker_to").value   = data_dict['yaw_dict']['date_to'];
            var data_len  = data_dict['yaw_dict']['data_len'];
            if( data_len <= 0 ){
                alert( "该查询日期内无数据");
                exit(0) ;
            }
            
            show_type = "day";
            init_data();
            draw_yaw_num_all_tables();
            draw_yaw_type_all_tables();
            button_port_yaw_info_click();
        }
    }

    function search_button_on_click(  ){
        var url = host + ":" + port_num + "/yawpos_summary_get_data";
        var info = "";
        info = info + "date_from=" + document.getElementById("datepicker_from").value ;
        info = info + "&date_to=" + document.getElementById("datepicker_to").value ;
        xmlHTTP.open("POST", url, true);
        xmlHTTP.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xmlHTTP.onreadystatechange = query_info_done;
        xmlHTTP.send( info );
    }
    
    
    
    
    
    
    
    var xmlHTTP_port = new XMLHttpRequest();
    function port_query_info_done(){
        if( xmlHTTP_port.readyState == 4 && xmlHTTP_port.status == 200){
            json_obj = eval('(' + xmlHTTP_port.responseText + ')');
            port_data_dict = json_obj;
            draw_yaw_num_one_port_tables();
            draw_yaw_type_one_port_tables();
        }
    }
  
    
    function button_port_yaw_info_click(){
        document.getElementById("div_yaw_port_type_info").style.display="none" ;
        document.getElementById("div_yaw_port_type_info_title").style.display="none" ;
        var select_port = document.getElementById("select_port_name").value ;
        select_port = port_number2port_name[ select_port ];
        var yaw_num_port = "unknown";
        var yaw_type_port = "unknown";
        for( var i in port_number2port_name ){
            if( port_number2port_name[i] == select_port ){
                yaw_num_port = i;
            }
        }
        
        for( var i in port_str2port_name ){
            if( port_str2port_name[i] == select_port ){
                yaw_type_port = i;
            }
        }
        var url = host + ":" + port_num + "/yawpos_summary2version_get_data";
        var info = "";
        info = info + "date_from=" + document.getElementById("datepicker_from").value ;
        info = info + "&date_to=" + document.getElementById("datepicker_to").value ;
        info = info + "&yaw_num_port=" + yaw_num_port ;
        info = info + "&yaw_type_port=" + yaw_type_port ;
        xmlHTTP_port.open("POST", url, true);
        xmlHTTP_port.setRequestHeader("Content-type","application/x-www-form-urlencoded");
        xmlHTTP_port.onreadystatechange = port_query_info_done;
        xmlHTTP_port.send( info );
    }
    
    search_button_on_click();
    
    
    
</script>



</html>
